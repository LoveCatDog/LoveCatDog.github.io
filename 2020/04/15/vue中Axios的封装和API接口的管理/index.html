<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>vue中Axios的封装和API接口的管理 | LoveCatDog</title><meta name="description" content="vue中Axios的封装和API接口的管理"><meta name="keywords" content="Vue"><meta name="author" content="会吃鱼的猫"><meta name="copyright" content="会吃鱼的猫"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="baidu-site-verification" content="RFDoZkn4Yp"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="vue中Axios的封装和API接口的管理"><meta name="twitter:description" content="vue中Axios的封装和API接口的管理"><meta name="twitter:image" content="https://th.wallhaven.cc/small/nk/nko8m7.jpg"><meta property="og:type" content="article"><meta property="og:title" content="vue中Axios的封装和API接口的管理"><meta property="og:url" content="https://lovecatdog.github.io/2020/04/15/vue%E4%B8%ADAxios%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CAPI%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AE%A1%E7%90%86/"><meta property="og:site_name" content="LoveCatDog"><meta property="og:description" content="vue中Axios的封装和API接口的管理"><meta property="og:image" content="https://th.wallhaven.cc/small/nk/nko8m7.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://lovecatdog.github.io/2020/04/15/vue%E4%B8%ADAxios%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CAPI%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AE%A1%E7%90%86/"><link rel="prev" title="git服务器如何存储本地ssh密钥" href="https://lovecatdog.github.io/2020/04/21/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%9C%AC%E5%9C%B0ssh%E5%AF%86%E9%92%A5/"><link rel="next" title="Webpack学习笔记二" href="https://lovecatdog.github.io/2020/04/14/Webpack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%BA%8C/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1e40f6d21c37a071ae4227ba97e3d222";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://lovecatdog.github.io/","msgToTraditionalChinese":"简","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">LoveCatDog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> MessagesBoard</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/./img/my.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> MessagesBoard</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#vue中Axios的封装和API接口的管理"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">vue中Axios的封装和API接口的管理</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#一、axios的封装"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">一、axios的封装</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#安装"><span class="toc_mobile_items-number">1.1.1.</span> <span class="toc_mobile_items-text">安装</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#引入"><span class="toc_mobile_items-number">1.1.2.</span> <span class="toc_mobile_items-text">引入</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#环境的切换"><span class="toc_mobile_items-number">1.1.3.</span> <span class="toc_mobile_items-text">环境的切换</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#设置请求超时"><span class="toc_mobile_items-number">1.1.4.</span> <span class="toc_mobile_items-text">设置请求超时</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#post请求头的设置"><span class="toc_mobile_items-number">1.1.5.</span> <span class="toc_mobile_items-text">post请求头的设置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#请求拦截"><span class="toc_mobile_items-number">1.1.6.</span> <span class="toc_mobile_items-text">请求拦截</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#响应的拦截"><span class="toc_mobile_items-number">1.1.7.</span> <span class="toc_mobile_items-text">响应的拦截</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#封装get方法和post方法"><span class="toc_mobile_items-number">1.1.8.</span> <span class="toc_mobile_items-text">封装get方法和post方法</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#axios的封装基本就完成了，下面再简单说下api的统一管理。"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">axios的封装基本就完成了，下面再简单说下api的统一管理。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#axios的封装根据需求的不同而不同。"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">axios的封装根据需求的不同而不同。</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#http-js中axios封装的优化，先直接贴代码："><span class="toc_mobile_items-number">1.3.1.</span> <span class="toc_mobile_items-text">http.js中axios封装的优化，先直接贴代码：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#下面说下api这块，考虑到一下需求："><span class="toc_mobile_items-number">1.3.2.</span> <span class="toc_mobile_items-text">下面说下api这块，考虑到一下需求：</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#vue中Axios的封装和API接口的管理"><span class="toc-number">1.</span> <span class="toc-text">vue中Axios的封装和API接口的管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、axios的封装"><span class="toc-number">1.1.</span> <span class="toc-text">一、axios的封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-number">1.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#引入"><span class="toc-number">1.1.2.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#环境的切换"><span class="toc-number">1.1.3.</span> <span class="toc-text">环境的切换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置请求超时"><span class="toc-number">1.1.4.</span> <span class="toc-text">设置请求超时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#post请求头的设置"><span class="toc-number">1.1.5.</span> <span class="toc-text">post请求头的设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#请求拦截"><span class="toc-number">1.1.6.</span> <span class="toc-text">请求拦截</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#响应的拦截"><span class="toc-number">1.1.7.</span> <span class="toc-text">响应的拦截</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#封装get方法和post方法"><span class="toc-number">1.1.8.</span> <span class="toc-text">封装get方法和post方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios的封装基本就完成了，下面再简单说下api的统一管理。"><span class="toc-number">1.2.</span> <span class="toc-text">axios的封装基本就完成了，下面再简单说下api的统一管理。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios的封装根据需求的不同而不同。"><span class="toc-number">1.3.</span> <span class="toc-text">axios的封装根据需求的不同而不同。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http-js中axios封装的优化，先直接贴代码："><span class="toc-number">1.3.1.</span> <span class="toc-text">http.js中axios封装的优化，先直接贴代码：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#下面说下api这块，考虑到一下需求："><span class="toc-number">1.3.2.</span> <span class="toc-text">下面说下api这块，考虑到一下需求：</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://www.cnblogs.com/skins/codinglife/images/title-yellow.png)"><div id="post-info"><div id="post-title"><div class="posttitle">vue中Axios的封装和API接口的管理</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-04-15<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-04-21</time><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">5k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 18 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/15/vue%E4%B8%ADAxios%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CAPI%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AE%A1%E7%90%86/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/04/15/vue%E4%B8%ADAxios%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CAPI%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AE%A1%E7%90%86/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h2 id="vue中Axios的封装和API接口的管理"><a href="#vue中Axios的封装和API接口的管理" class="headerlink" title="vue中Axios的封装和API接口的管理"></a>vue中Axios的封装和API接口的管理</h2><blockquote>
<p>我们所要的说的axios的封装和api接口的统一管理，其实主要目的就是在帮助我们简化代码和利于后期的更新维护。</p>
</blockquote>
<h3 id="一、axios的封装"><a href="#一、axios的封装" class="headerlink" title="一、axios的封装"></a>一、axios的封装</h3><p>在vue项目中，和后台交互获取数据这块，我们通常使用的是axios库，它是基于promise的http库，可运行在浏览器端和node.js中。他有很多优秀的特性，例如拦截请求和响应、取消请求、转换json、客户端防御XSRF等。详情可参考<a href="http://www.axios-js.com/" target="_blank" rel="noopener">axios文档</a></p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios; <span class="comment">// 安装axios</span></span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h4><blockquote>
<p>一般我会在项目的src目录中，新建一个request文件夹，然后在里面新建一个http.js和一个api.js文件。http.js文件用来封装我们的axios，api.js用来统一管理我们的接口。</p>
</blockquote>
<p><strong>http.js</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在http.js中引入axios</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>; <span class="comment">// 引入axios</span></span><br><span class="line"><span class="keyword">import</span> QS <span class="keyword">from</span> <span class="string">'qs'</span>; <span class="comment">// 引入qs模块，用来序列化post类型的数据，后面会提到</span></span><br><span class="line"><span class="comment">// vant的toast提示框组件，大家可根据自己的ui组件更改。</span></span><br><span class="line"><span class="keyword">import</span> { Toast } <span class="keyword">from</span> <span class="string">'vant'</span>;</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="环境的切换"><a href="#环境的切换" class="headerlink" title="环境的切换"></a>环境的切换</h4><blockquote>
<p>我们的项目环境可能有开发环境、测试环境和生产环境。我们通过node的环境变量来匹配我们的默认的接口url前缀。axios.defaults.baseURL可以设置axios的默认请求地址就不多说了。</p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 环境的切换</span></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'development'</span>) {    </span><br><span class="line">    axios.defaults.baseURL = <span class="string">'https://www.baidu.com'</span>;} </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'debug'</span>) {    </span><br><span class="line">    axios.defaults.baseURL = <span class="string">'https://www.ceshi.com'</span>;</span><br><span class="line">} </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'production'</span>) {    </span><br><span class="line">    axios.defaults.baseURL = <span class="string">'https://www.production.com'</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="设置请求超时"><a href="#设置请求超时" class="headerlink" title="设置请求超时"></a>设置请求超时</h4><blockquote>
<p>通过axios.defaults.timeout设置默认的请求超时时间。例如超过了10s，就会告知用户当前请求超时，请刷新等。</p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.timeout = <span class="number">10000</span>;</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="post请求头的设置"><a href="#post请求头的设置" class="headerlink" title="post请求头的设置"></a>post请求头的设置</h4><blockquote>
<p>post请求的时候，我们需要加上一个请求头，所以可以在这里进行一个默认的设置，即设置post的请求头为application/x-www-form-urlencoded;charset=UTF-8</p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span>;</span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li><p>请求拦截</p>
<p>我们在发送请求前可以进行一个请求的拦截，为什么要拦截呢，我们拦截请求是用来做什么的呢？比如，有些请求是需要用户登录之后才能访问的，或者post请求的时候，我们需要序列化我们提交的数据。这时候，我们可以在请求被发送之前进行一个拦截，从而进行我们想要的操作。</p>
<h4 id="请求拦截"><a href="#请求拦截" class="headerlink" title="请求拦截"></a>请求拦截</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">'@/store/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器axios.interceptors.request.use(    </span></span><br><span class="line">    config => {        </span><br><span class="line">        <span class="comment">// 每次发送请求之前判断vuex中是否存在token        </span></span><br><span class="line">        <span class="comment">// 如果存在，则统一在http请求的header都加上token，这样后台根据token判断你的登录情况</span></span><br><span class="line">        <span class="comment">// 即使本地存在token，也有可能token是过期的，所以在响应拦截器中要对返回状态进行判断 </span></span><br><span class="line">        <span class="keyword">const</span> token = store.state.token;        </span><br><span class="line">        token && (config.headers.Authorization = token);        </span><br><span class="line">        <span class="keyword">return</span> config;    </span><br><span class="line">    },    </span><br><span class="line">    error => {        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.error(error);    </span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure></div>

<p>这里说一下token，一般是在登录完成之后，将用户的token通过localStorage或者cookie存在本地，然后用户每次在进入页面的时候（即在main.js中），会首先从本地存储中读取token，如果token存在说明用户已经登陆过，则更新vuex中的token状态。然后，在每次请求接口的时候，都会在请求的header中携带token，后台人员就可以根据你携带的token来判断你的登录是否过期，如果没有携带，则说明没有登录过。这时候或许有些小伙伴会有疑问了，就是每个请求都携带token，那么要是一个页面不需要用户登录就可以访问的怎么办呢？其实，你前端的请求可以携带token，但是后台可以选择不接收啊！</p>
<h4 id="响应的拦截"><a href="#响应的拦截" class="headerlink" title="响应的拦截"></a>响应的拦截</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 响应拦截器</span></span><br><span class="line">axios.interceptors.response.use(    </span><br><span class="line">    response => {   </span><br><span class="line">        <span class="comment">// 如果返回的状态码为200，说明接口请求成功，可以正常拿到数据     </span></span><br><span class="line">        <span class="comment">// 否则的话抛出错误</span></span><br><span class="line">        <span class="keyword">if</span> (response.status === <span class="number">200</span>) {            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(response);        </span><br><span class="line">        } <span class="keyword">else</span> {            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(response);        </span><br><span class="line">        }    </span><br><span class="line">    },    </span><br><span class="line">    <span class="comment">// 服务器状态码不是2开头的的情况</span></span><br><span class="line">    <span class="comment">// 这里可以跟你们的后台开发人员协商好统一的错误状态码    </span></span><br><span class="line">    <span class="comment">// 然后根据返回的状态码进行一些操作，例如登录过期提示，错误提示等等</span></span><br><span class="line">    <span class="comment">// 下面列举几个常见的操作，其他需求可自行扩展</span></span><br><span class="line">    error => {            </span><br><span class="line">        <span class="keyword">if</span> (error.response.status) {            </span><br><span class="line">            <span class="keyword">switch</span> (error.response.status) {                </span><br><span class="line">                <span class="comment">// 401: 未登录</span></span><br><span class="line">                <span class="comment">// 未登录则跳转登录页面，并携带当前页面的路径</span></span><br><span class="line">                <span class="comment">// 在登录成功后返回当前页面，这一步需要在登录页操作。                </span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">401</span>:                    </span><br><span class="line">                    router.replace({                        </span><br><span class="line">                        path: <span class="string">'/login'</span>,                        </span><br><span class="line">                        query: { </span><br><span class="line">                            redirect: router.currentRoute.fullPath </span><br><span class="line">                        }</span><br><span class="line">                    });</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 403 token过期</span></span><br><span class="line">                <span class="comment">// 登录过期对用户进行提示</span></span><br><span class="line">                <span class="comment">// 清除本地token和清空vuex中token对象</span></span><br><span class="line">                <span class="comment">// 跳转登录页面                </span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">                     Toast({</span><br><span class="line">                        message: <span class="string">'登录过期，请重新登录'</span>,</span><br><span class="line">                        duration: <span class="number">1000</span>,</span><br><span class="line">                        forbidClick: <span class="literal">true</span></span><br><span class="line">                    });</span><br><span class="line">                    <span class="comment">// 清除token</span></span><br><span class="line">                    localStorage.removeItem(<span class="string">'token'</span>);</span><br><span class="line">                    store.commit(<span class="string">'loginSuccess'</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 跳转登录页面，并将要浏览的页面fullPath传过去，登录成功后跳转需要访问的页面 </span></span><br><span class="line">                    setTimeout(<span class="function"><span class="params">()</span> =></span> {                        </span><br><span class="line">                        router.replace({                            </span><br><span class="line">                            path: <span class="string">'/login'</span>,                            </span><br><span class="line">                            query: { </span><br><span class="line">                                redirect: router.currentRoute.fullPath </span><br><span class="line">                            }                        </span><br><span class="line">                        });                    </span><br><span class="line">                    }, <span class="number">1000</span>);                    </span><br><span class="line">                    <span class="keyword">break</span>; </span><br><span class="line"></span><br><span class="line">                <span class="comment">// 404请求不存在</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">                    Toast({</span><br><span class="line">                        message: <span class="string">'网络请求不存在'</span>,</span><br><span class="line">                        duration: <span class="number">1500</span>,</span><br><span class="line">                        forbidClick: <span class="literal">true</span></span><br><span class="line">                    });</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// 其他错误，直接抛出错误提示</span></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    Toast({</span><br><span class="line">                        message: error.response.data.message,</span><br><span class="line">                        duration: <span class="number">1500</span>,</span><br><span class="line">                        forbidClick: <span class="literal">true</span></span><br><span class="line">                    });</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response);</span><br><span class="line">        }</span><br><span class="line">    }    </span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div>

<p>响应拦截器很好理解，就是服务器返回给我们的数据，我们在拿到之前可以对他进行一些处理。例如上面的思想：如果后台返回的状态码是200，则正常返回数据，否则的根据错误的状态码类型进行一些我们需要的错误，其实这里主要就是进行了错误的统一处理和没登录或登录过期后调整登录页的一个操作。</p>
<p><strong>注意：</strong><br>响应拦截器很好理解，就是服务器返回给我们的数据，我们在拿到之前可以对他进行一些处理。例如上面的思想：如果后台返回的状态码是200，则正常返回数据，否则的根据错误的状态码类型进行一些我们需要的错误，其实这里主要就是进行了错误的统一处理和没登录或登录过期后调整登录页的一个操作。</p>
</li>
</ul>
<h4 id="封装get方法和post方法"><a href="#封装get方法和post方法" class="headerlink" title="封装get方法和post方法"></a>封装get方法和post方法</h4><blockquote>
<p>我们常用的ajax请求方法有get、post、put等方法，相信小伙伴都不会陌生。axios对应的也有很多类似的方法，不清楚的可以看下文档。但是为了简化我们的代码，我们还是要对其进行一个简单的封装。下面我们主要封装两个方法：get和post。</p>
</blockquote>
<ul>
<li><strong>get方法：</strong><br>我们通过定义一个get函数，get函数有两个参数，第一个参数表示我们要请求的url地址，第二个参数是我们要携带的请求参数。get函数返回一个promise对象，当axios其请求成功时resolve服务器返回 值，请求失败时reject错误值。最后通过export抛出get函数。</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * get方法，对应get请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{String}</span> </span>url [请求的url地址]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{Object}</span> </span>params [请求时携带的参数]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url, params</span>)</span>{    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =></span>{        </span><br><span class="line">        axios.get(url, {            </span><br><span class="line">            params: params        </span><br><span class="line">        }).then(<span class="function"><span class="params">res</span> =></span> {</span><br><span class="line">            resolve(res.data);</span><br><span class="line">        }).catch(<span class="function"><span class="params">err</span> =></span>{</span><br><span class="line">            reject(err.data)        </span><br><span class="line">    })    </span><br><span class="line">});}</span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li><strong>post方法：</strong><br>原理同get基本一样，但是要注意的是，post方法必须要使用对提交从参数对象进行序列化的操作，所以这里我们通过node的qs模块来序列化我们的参数。这个很重要，如果没有序列化操作，后台是拿不到你提交的数据的。这就是文章开头我们import QS from ‘qs’;的原因。如果不明白序列化是什么意思的，就百度一下吧，答案一大堆。</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * post方法，对应post请求 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{String}</span> </span>url [请求的url地址] </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{Object}</span> </span>params [请求时携带的参数] </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">url, params</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =></span> {</span><br><span class="line">         axios.post(url, QS.stringify(params))</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =></span> {</span><br><span class="line">            resolve(res.data);</span><br><span class="line">        })</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =></span>{</span><br><span class="line">            reject(err.data)</span><br><span class="line">        })</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>


<p><strong>注意</strong><br>这里有个小细节说下，axios.get()方法和axios.post()在提交数据时参数的书写方式还是有区别的。区别就是，get的第二个参数是一个{}，然后这个对象的params属性值是一个参数对象的。而post的第二个参数就是一个参数对象。两者略微的区别要留意哦！</p>
<h3 id="axios的封装基本就完成了，下面再简单说下api的统一管理。"><a href="#axios的封装基本就完成了，下面再简单说下api的统一管理。" class="headerlink" title="axios的封装基本就完成了，下面再简单说下api的统一管理。"></a>axios的封装基本就完成了，下面再简单说下api的统一管理。</h3><blockquote>
<p>整齐的api就像电路板一样，即使再复杂也能很清晰整个线路。上面说了，我们会新建一个api.js,然后在这个文件中存放我们所有的api接口。</p>
</blockquote>
<ul>
<li>首先我们在api.js中引入我们封装的get和post方法</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**   </span></span><br><span class="line"><span class="comment"> * api接口统一管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> { <span class="keyword">get</span>, post } from './http'</span><br></pre></td></tr></tbody></table></figure></div>

<p>现在，例如我们有这样一个接口，是一个post请求：</p>
<blockquote>
<p><a href="http://www.baiodu.com/api/v1/users/my_address/address_edit_before" target="_blank" rel="noopener">http://www.baiodu.com/api/v1/users/my_address/address_edit_before</a></p>
</blockquote>
<p>我们可以在api.js中这样封装：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> apiAddress = <span class="function">(<span class="params">params</span>) =></span> post(<span class="string">'api/v1/users/my_address/address_edit_before'</span>, params);</span><br></pre></td></tr></tbody></table></figure></div>

<p>我们定义了一个apiAddress方法，这个方法有一个参数params，params是我们请求接口时携带的参数对象。而后调用了我们封装的post方法，post方法的第一个参数是我们的接口地址，第二个参数是apiAddress的p参数，即请求接口时携带的参数对象。最后通过export导出apiAddress。<br>然后在我们的页面中可以这样调用我们的api接口：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> { apiAddress } <span class="keyword">from</span> <span class="string">'@/request/api'</span>;<span class="comment">// 导入我们的api接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {        </span><br><span class="line">    name: <span class="string">'Address'</span>,    </span><br><span class="line">    created () {</span><br><span class="line">        <span class="keyword">this</span>.onLoad();</span><br><span class="line">    },</span><br><span class="line">    methods: {            </span><br><span class="line">        <span class="comment">// 获取数据            </span></span><br><span class="line">        onLoad() {</span><br><span class="line">            <span class="comment">// 调用api接口，并且提供了两个参数                </span></span><br><span class="line">            apiAddress({                    </span><br><span class="line">                type: <span class="number">0</span>,                    </span><br><span class="line">                sort: <span class="number">1</span>                </span><br><span class="line">            }).then(<span class="function"><span class="params">res</span> =></span> {</span><br><span class="line">                <span class="comment">// 获取数据成功后的其他操作</span></span><br><span class="line">                ………………                </span><br><span class="line">            })            </span><br><span class="line">        }        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>其他的api接口，就在pai.js中继续往下面扩展就可以了。友情提示，为每个接口写好注释哦！！！</p>
<p>api接口管理的一个好处就是，我们把api统一集中起来，如果后期需要修改接口，我们就直接在api.js中找到对应的修改就好了，而不用去每一个页面查找我们的接口然后再修改会很麻烦。关键是，万一修改的量比较大，就规格gg了。还有就是如果直接在我们的业务代码修改接口，一不小心还容易动到我们的业务代码造成不必要的麻烦。</p>
<p>好了，最后把完成的axios封装代码奉上。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**axios封装</span></span><br><span class="line"><span class="comment"> * 请求拦截、相应拦截、错误统一处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;<span class="keyword">import</span> QS <span class="keyword">from</span> <span class="string">'qs'</span>;</span><br><span class="line"><span class="keyword">import</span> { Toast } <span class="keyword">from</span> <span class="string">'vant'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'../store/index'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 环境的切换</span></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'development'</span>) {    </span><br><span class="line">    axios.defaults.baseURL = <span class="string">'/api'</span>;</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'debug'</span>) {    </span><br><span class="line">    axios.defaults.baseURL = <span class="string">''</span>;</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'production'</span>) {    </span><br><span class="line">    axios.defaults.baseURL = <span class="string">'http://api.123dailu.com/'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求超时时间</span></span><br><span class="line">axios.defaults.timeout = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// post请求头</span></span><br><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">axios.interceptors.request.use(    </span><br><span class="line">    config => {</span><br><span class="line">        <span class="comment">// 每次发送请求之前判断是否存在token，如果存在，则统一在http请求的header都加上token，不用每次请求都手动添加了</span></span><br><span class="line">        <span class="comment">// 即使本地存在token，也有可能token是过期的，所以在响应拦截器中要对返回状态进行判断</span></span><br><span class="line">        <span class="keyword">const</span> token = store.state.token;        </span><br><span class="line">        token && (config.headers.Authorization = token);        </span><br><span class="line">        <span class="keyword">return</span> config;    </span><br><span class="line">    },    </span><br><span class="line">    error => {        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.error(error);    </span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">axios.interceptors.response.use(    </span><br><span class="line">    response => {        </span><br><span class="line">        <span class="keyword">if</span> (response.status === <span class="number">200</span>) {            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(response);        </span><br><span class="line">        } <span class="keyword">else</span> {            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(response);        </span><br><span class="line">        }    </span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 服务器状态码不是200的情况    </span></span><br><span class="line">    error => {        </span><br><span class="line">        <span class="keyword">if</span> (error.response.status) {            </span><br><span class="line">            <span class="keyword">switch</span> (error.response.status) {                </span><br><span class="line">                <span class="comment">// 401: 未登录                </span></span><br><span class="line">                <span class="comment">// 未登录则跳转登录页面，并携带当前页面的路径                </span></span><br><span class="line">                <span class="comment">// 在登录成功后返回当前页面，这一步需要在登录页操作。                </span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">401</span>:                    </span><br><span class="line">                    router.replace({                        </span><br><span class="line">                        path: <span class="string">'/login'</span>,                        </span><br><span class="line">                        query: { <span class="attr">redirect</span>: router.currentRoute.fullPath } </span><br><span class="line">                    });</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// 403 token过期                </span></span><br><span class="line">                <span class="comment">// 登录过期对用户进行提示                </span></span><br><span class="line">                <span class="comment">// 清除本地token和清空vuex中token对象                </span></span><br><span class="line">                <span class="comment">// 跳转登录页面                </span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">403</span>:                     </span><br><span class="line">                    Toast({                        </span><br><span class="line">                        message: <span class="string">'登录过期，请重新登录'</span>,                        </span><br><span class="line">                        duration: <span class="number">1000</span>,                        </span><br><span class="line">                        forbidClick: <span class="literal">true</span>                    </span><br><span class="line">                    });                    </span><br><span class="line">                    <span class="comment">// 清除token                    </span></span><br><span class="line">                    localStorage.removeItem(<span class="string">'token'</span>);                    </span><br><span class="line">                    store.commit(<span class="string">'loginSuccess'</span>, <span class="literal">null</span>);                    </span><br><span class="line">                    <span class="comment">// 跳转登录页面，并将要浏览的页面fullPath传过去，登录成功后跳转需要访问的页面</span></span><br><span class="line">                    setTimeout(<span class="function"><span class="params">()</span> =></span> {                        </span><br><span class="line">                        router.replace({                            </span><br><span class="line">                            path: <span class="string">'/login'</span>,                            </span><br><span class="line">                            query: { </span><br><span class="line">                                redirect: router.currentRoute.fullPath </span><br><span class="line">                            }                        </span><br><span class="line">                        });                    </span><br><span class="line">                    }, <span class="number">1000</span>);                    </span><br><span class="line">                    <span class="keyword">break</span>; </span><br><span class="line">                <span class="comment">// 404请求不存在                </span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">404</span>:                    </span><br><span class="line">                    Toast({                        </span><br><span class="line">                        message: <span class="string">'网络请求不存在'</span>,                        </span><br><span class="line">                        duration: <span class="number">1500</span>,                        </span><br><span class="line">                        forbidClick: <span class="literal">true</span>                    </span><br><span class="line">                    });                    </span><br><span class="line">                <span class="keyword">break</span>;                </span><br><span class="line">                <span class="comment">// 其他错误，直接抛出错误提示                </span></span><br><span class="line">                <span class="keyword">default</span>:                    </span><br><span class="line">                    Toast({                        </span><br><span class="line">                        message: error.response.data.message,                        </span><br><span class="line">                        duration: <span class="number">1500</span>,                        </span><br><span class="line">                        forbidClick: <span class="literal">true</span>                    </span><br><span class="line">                    });            </span><br><span class="line">            }            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response);        </span><br><span class="line">        }       </span><br><span class="line">    }</span><br><span class="line">);</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * get方法，对应get请求 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{String}</span> </span>url [请求的url地址] </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{Object}</span> </span>params [请求时携带的参数] </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url, params</span>)</span>{    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =></span>{        </span><br><span class="line">        axios.get(url, {            </span><br><span class="line">            params: params        </span><br><span class="line">        })        </span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =></span> {            </span><br><span class="line">            resolve(res.data);        </span><br><span class="line">        })        </span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =></span> {            </span><br><span class="line">            reject(err.data)        </span><br><span class="line">        })    </span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * post方法，对应post请求 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{String}</span> </span>url [请求的url地址] </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{Object}</span> </span>params [请求时携带的参数] </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">url, params</span>) </span>{    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =></span> {         </span><br><span class="line">        axios.post(url, QS.stringify(params))        </span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =></span> {            </span><br><span class="line">            resolve(res.data);        </span><br><span class="line">        })        </span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =></span> {            </span><br><span class="line">            reject(err.data)        </span><br><span class="line">        })    </span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="axios的封装根据需求的不同而不同。"><a href="#axios的封装根据需求的不同而不同。" class="headerlink" title="axios的封装根据需求的不同而不同。"></a>axios的封装根据需求的不同而不同。</h3><ol>
<li>优化axios封装，去掉之前的get和post</li>
<li>断网情况处理</li>
<li>更加模块化的api管理</li>
<li>接口域名有多个的情况</li>
<li>api挂载到vue.prototype上省去引入的步骤</li>
</ol>
<h4 id="http-js中axios封装的优化，先直接贴代码："><a href="#http-js中axios封装的优化，先直接贴代码：" class="headerlink" title="http.js中axios封装的优化，先直接贴代码："></a>http.js中axios封装的优化，先直接贴代码：</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * axios封装</span></span><br><span class="line"><span class="comment"> * 请求拦截、响应拦截、错误统一处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'../router'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'../store/index'</span>;</span><br><span class="line"><span class="keyword">import</span> { Toast } <span class="keyword">from</span> <span class="string">'vant'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 提示函数 </span></span><br><span class="line"><span class="comment"> * 禁止点击蒙层、显示一秒后关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> tip = <span class="function"><span class="params">msg</span> =></span> {    </span><br><span class="line">    Toast({        </span><br><span class="line">        message: msg,        </span><br><span class="line">        duration: <span class="number">1000</span>,        </span><br><span class="line">        forbidClick: <span class="literal">true</span>    </span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 跳转登录页</span></span><br><span class="line"><span class="comment"> * 携带当前页面路由，以期在登录页面完成登录后返回当前页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> toLogin = <span class="function"><span class="params">()</span> =></span> {</span><br><span class="line">    router.replace({</span><br><span class="line">        path: <span class="string">'/login'</span>,        </span><br><span class="line">        query: {</span><br><span class="line">            redirect: router.currentRoute.fullPath</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 请求失败后的错误统一处理 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{Number}</span> </span>status 请求失败的状态码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> errorHandle = <span class="function">(<span class="params">status, other</span>) =></span> {</span><br><span class="line">    <span class="comment">// 状态码判断</span></span><br><span class="line">    <span class="keyword">switch</span> (status) {</span><br><span class="line">        <span class="comment">// 401: 未登录状态，跳转登录页</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">            toLogin();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// 403 token过期</span></span><br><span class="line">        <span class="comment">// 清除token并跳转登录页</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">            tip(<span class="string">'登录过期，请重新登录'</span>);</span><br><span class="line">            localStorage.removeItem(<span class="string">'token'</span>);</span><br><span class="line">            store.commit(<span class="string">'loginSuccess'</span>, <span class="literal">null</span>);</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =></span> {</span><br><span class="line">                toLogin();</span><br><span class="line">            }, <span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// 404请求不存在</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">            tip(<span class="string">'请求的资源不存在'</span>); </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">console</span>.log(other);   </span><br><span class="line">        }}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">var</span> instance = axios.create({    <span class="attr">timeout</span>: <span class="number">1000</span> * <span class="number">12</span>});</span><br><span class="line"><span class="comment">// 设置post请求头</span></span><br><span class="line">instance.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded'</span>;</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 请求拦截器 </span></span><br><span class="line"><span class="comment"> * 每次请求前，如果存在token则在请求头中携带token </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line">instance.interceptors.request.use(    </span><br><span class="line">    config => {        </span><br><span class="line">        <span class="comment">// 登录流程控制中，根据本地是否存在token判断用户的登录情况        </span></span><br><span class="line">        <span class="comment">// 但是即使token存在，也有可能token是过期的，所以在每次的请求头中携带token        </span></span><br><span class="line">        <span class="comment">// 后台根据携带的token判断用户的登录情况，并返回给我们对应的状态码        </span></span><br><span class="line">        <span class="comment">// 而后我们可以在响应拦截器中，根据状态码进行一些统一的操作。        </span></span><br><span class="line">        <span class="keyword">const</span> token = store.state.token;        </span><br><span class="line">        token && (config.headers.Authorization = token);        </span><br><span class="line">        <span class="keyword">return</span> config;    </span><br><span class="line">    },    </span><br><span class="line">    error => <span class="built_in">Promise</span>.error(error))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">instance.interceptors.response.use(    </span><br><span class="line">    <span class="comment">// 请求成功</span></span><br><span class="line">    res => res.status === <span class="number">200</span> ? <span class="built_in">Promise</span>.resolve(res) : <span class="built_in">Promise</span>.reject(res),    </span><br><span class="line">    <span class="comment">// 请求失败</span></span><br><span class="line">    error => {</span><br><span class="line">        <span class="keyword">const</span> { response } = error;</span><br><span class="line">        <span class="keyword">if</span> (response) {</span><br><span class="line">            <span class="comment">// 请求已发出，但是不在2xx的范围 </span></span><br><span class="line">            errorHandle(response.status, response.data.message);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(response);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 处理断网的情况</span></span><br><span class="line">            <span class="comment">// eg:请求超时或断网时，更新state的network状态</span></span><br><span class="line">            <span class="comment">// network状态在app.vue中控制着一个全局的断网提示组件的显示隐藏</span></span><br><span class="line">            <span class="comment">// 关于断网组件中的刷新重新获取数据，会在断网组件中说明</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">window</span>.navigator.onLine) {</span><br><span class="line">               store.commit(<span class="string">'changeNetwork'</span>, <span class="literal">false</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> instance;</span><br></pre></td></tr></tbody></table></figure></div>

<p>这个axios和之前的大同小异，做了如下几点改变：</p>
<ol>
<li>去掉了之前get和post方法的封装，通过创建一个axios实例然后export default方法导出，这样使用起来更灵活一些。</li>
<li>去掉了通过环境变量控制baseUrl的值。考虑到接口会有多个不同域名的情况，所以准备通过js变量来控制接口域名。这点具体在api里会介绍。</li>
<li>增加了请求超时，即断网状态的处理。说下思路，当断网时，通过更新vuex中network的状态来控制断网提示组件的显示隐藏。断网提示一般会有重新加载数据的操作，这步会在后面对应的地方介绍。</li>
<li>公用函数进行抽出，简化代码，尽量保证单一职责原则。</li>
</ol>
<h4 id="下面说下api这块，考虑到一下需求："><a href="#下面说下api这块，考虑到一下需求：" class="headerlink" title="下面说下api这块，考虑到一下需求："></a>下面说下api这块，考虑到一下需求：</h4><ol>
<li>更加模块化</li>
<li>更方便多人开发，有效减少解决命名冲突</li>
<li>处理接口域名有多个情况</li>
</ol>
<p>这里这里呢新建了一个api文件夹，里面有一个index.js和一个base.js，以及多个根据模块划分的接口js文件。index.js是一个api的出口，base.js管理接口域名，其他js则用来管理各个模块的接口。</p>
<p>先放index.js代码：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * api接口的统一出口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 文章模块接口</span></span><br><span class="line"><span class="keyword">import</span> article <span class="keyword">from</span> <span class="string">'@/api/article'</span>;</span><br><span class="line"><span class="comment">// 其他模块的接口……</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {    </span><br><span class="line">    article,</span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>index.js是一个api接口的出口，这样就可以把api接口根据功能划分为多个模块，利于多人协作开发，比如一个人只负责一个模块的开发等，还能方便每个模块中接口的命名哦。</p>
<p>base.js:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口域名的管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> base = {    </span><br><span class="line">    sq: <span class="string">'https://xxxx111111.com/api/v1'</span>,    </span><br><span class="line">    bd: <span class="string">'http://xxxxx22222.com/api'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> base;</span><br></pre></td></tr></tbody></table></figure></div>


<p>通过base.js来管理我们的接口域名，不管有多少个都可以通过这里进行接口的定义。即使修改起来，也是很方便的。</p>
<p>最后就是接口模块的说明，例如上面的article.js:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * article模块接口列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">'./base'</span>; <span class="comment">// 导入接口域名列表</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'@/utils/http'</span>; <span class="comment">// 导入http中创建的axios实例</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span>; <span class="comment">// 根据需求是否导入qs模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> article = {    </span><br><span class="line">    <span class="comment">// 新闻列表    </span></span><br><span class="line">    articleList () {        </span><br><span class="line">        <span class="keyword">return</span> axios.get(<span class="string">`<span class="subst">${base.sq}</span>/topics`</span>);    </span><br><span class="line">    },    </span><br><span class="line">    <span class="comment">// 新闻详情,演示    </span></span><br><span class="line">    articleDetail (id, params) {        </span><br><span class="line">        <span class="keyword">return</span> axios.get(<span class="string">`<span class="subst">${base.sq}</span>/topic/<span class="subst">${id}</span>`</span>, {            </span><br><span class="line">            params: params        </span><br><span class="line">        });    </span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// post提交    </span></span><br><span class="line">    login (params) {        </span><br><span class="line">        <span class="keyword">return</span> axios.post(<span class="string">`<span class="subst">${base.sq}</span>/accesstoken`</span>, qs.stringify(params));    </span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 其他接口…………</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> article;</span><br></pre></td></tr></tbody></table></figure></div>

<ol>
<li><p>通过直接引入我们封装好的axios实例，然后定义接口、调用axios实例并返回，可以更灵活的使用axios，比如你可以对post请求时提交的数据进行一个qs序列化的处理等。</p>
</li>
<li><p>请求的配置更灵活，你可以针对某个需求进行一个不同的配置。关于配置的优先级，axios文档说的很清楚，这个顺序是：在 lib/defaults.js 找到的库的默认值，然后是实例的 defaults 属性，最后是请求的 config 参数。后者将优先于前者。</p>
</li>
<li><p>restful风格的接口，也可以通过这种方式灵活的设置api接口地址。</p>
</li>
</ol>
<p>最后，为了方便api的调用，我们需要将其挂载到vue的原型上。在main.js中：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span> <span class="comment">// 导入路由文件</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span> <span class="comment">// 导入vuex文件</span></span><br><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">'./api'</span> <span class="comment">// 导入api接口</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>然后我们可以在页面中这样调用接口，eg：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: {    </span><br><span class="line">    onLoad(id) {      </span><br><span class="line">        <span class="keyword">this</span>.$api.article.articleDetail(id, {        </span><br><span class="line">            api: <span class="number">123</span>      </span><br><span class="line">        }).then(<span class="function"><span class="params">res</span>=></span> {</span><br><span class="line">            <span class="comment">// 执行某些操作      </span></span><br><span class="line">        })    </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>再提一下断网的处理，这里只做一个简单的示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">template</span>></span>  </span><br><span class="line">    <span class="tag"><<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>></span>    </span><br><span class="line">        <span class="tag"><<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"!network"</span>></span>      </span><br><span class="line">            <span class="tag"><<span class="name">h3</span>></span>我没网了<span class="tag"><!--<span class="name"-->h3</span>></span>      <br><span class="line">            <span class="tag"><<span class="name">div</span> @<span class="attr">click</span>=<span class="string">"onRefresh"</span>></span>刷新<span class="tag"><!--<span class="name"-->div</span>></span>      <br><span class="line">        <span class="tag"><!--<span class="name"-->div</span>></span>    <br><span class="line">        <span class="tag"><<span class="name">router-view</span>/></span>      </span><br><span class="line">    <span class="tag"><!--<span class="name"-->div</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->template</span>></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">script</span>></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> { mapState } <span class="keyword">from</span> <span class="string">'vuex'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> {  </span></span><br><span class="line"><span class="actionscript">        name: <span class="string">'App'</span>,  </span></span><br><span class="line">        computed: {    </span><br><span class="line"><span class="actionscript">            ...mapState([<span class="string">'network'</span>])  </span></span><br><span class="line">        },  </span><br><span class="line">        methods: {    </span><br><span class="line"><span class="actionscript">            <span class="comment">// 通过跳转一个空页面再返回的方式来实现刷新当前页面数据的目的</span></span></span><br><span class="line">            onRefresh () {      </span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.$router.replace(<span class="string">'/refresh'</span>)    </span></span><br><span class="line">            }  </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"><span class="tag"><!--<span class="name"-->script</span>></span><br></pre></td></tr></tbody></table></figure></div>

<p>这是app.vue，这里简单演示一下断网。在http.js中介绍了，我们会在断网的时候，来更新vue中network的状态，那么这里我们根据network的状态来判断是否需要加载这个断网组件。断网情况下，加载断网组件，不加载对应页面的组件。当点击刷新的时候，我们通过跳转refesh页面然后立即返回的方式来实现重新获取数据的操作。因此我们需要新建一个refresh.vue页面，并在其beforeRouteEnter钩子中再返回当前页面。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// refresh.vue</span></span><br><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) {</span><br><span class="line">    next(<span class="function"><span class="params">vm</span> =></span> {            </span><br><span class="line">        vm.$router.replace(<span class="keyword">from</span>.fullPath)        </span><br><span class="line">    })    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>这是一种全局通用的断网提示，当然了，也可以根据自己的项目需求操作。具体操作就仁者见仁智者见智了。</p>
<p>如果更多的需求，或者说是不一样的需求，可以根据自己的需求进行一个改进。</p>
<!-- https://juejin.im/post/5b55c118f265da0f6f1aa354 --></body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">会吃鱼的猫</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lovecatdog.github.io/2020/04/15/vue%E4%B8%ADAxios%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CAPI%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AE%A1%E7%90%86/">https://lovecatdog.github.io/2020/04/15/vue%E4%B8%ADAxios%E7%9A%84%E5%B0%81%E8%A3%85%E5%92%8CAPI%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%AE%A1%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lovecatdog.github.io">LoveCatDog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Vue/">Vue    </a></div><div class="post_share"><div class="social-share" data-image="https://th.wallhaven.cc/small/nk/nko8m7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/./img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/./img/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/21/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%9C%AC%E5%9C%B0ssh%E5%AF%86%E9%92%A5/"><img class="prev_cover lazyload" data-src="https://pic.downk.cc/item/5e9e786ac2a9a83be545c86d.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>git服务器如何存储本地ssh密钥</span></div></a></div><div class="next-post pull_right"><a href="/2020/04/14/Webpack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%BA%8C/"><img class="next_cover lazyload" data-src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2617879016,3871876383&amp;fm=15&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Webpack学习笔记二</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/01/19/Vuex是什么？/" title="Vuex是什么？"><img class="relatedPosts_cover lazyload"data-src="https://vuex.vuejs.org/flow.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">Vuex是什么？</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/06/vue中props传值失败/" title="vue中props传值失败"><img class="relatedPosts_cover lazyload"data-src="https://th.wallhaven.cc/small/nk/nko8m7.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">vue中props传值失败</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/16/vue开发使用的插件大集合/" title="vue开发使用的插件大集合"><img class="relatedPosts_cover lazyload"data-src="https://th.wallhaven.cc/small/4y/4yv6k7.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">vue开发使用的插件大集合</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/06/vue生命周期/" title="vue生命周期"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1485227289,2712798579&fm=11&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">vue生命周期</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/09/js手写日历/" title="js手写日历"><img class="relatedPosts_cover lazyload"data-src="https://th.wallhaven.cc/lg/xl/xl2qgo.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">js手写日历</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'Y37T7Fpa08tJzA8Yu3ytYxUn-gzGzoHsz',
  appKey:'3gQdh28WvdTKTcIsgat6NErV',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 会吃鱼的猫</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://lovecatdog.github.io/">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简体中文</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script id="ribbon_piao" mobile="undefined" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true; 
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script></body></html>